<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MK SPORT - OFFICIAL</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Three.js (Background) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <style>
        body { margin: 0; overflow-x: hidden; background-color: #000; color: white; font-family: 'Rajdhani', sans-serif; perspective: 1000px; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        
        /* --- STYLES --- */
        .btn-3d-cyan {
            background: linear-gradient(to bottom, #06b6d4, #0891b2);
            color: white; border: none; border-radius: 4px;
            box-shadow: 0px 4px 0px 0px #155e75, 0px 0px 15px rgba(6, 182, 212, 0.6);
            transition: all 0.1s; position: relative; top: 0; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px;
            clip-path: polygon(10% 0, 100% 0, 100% 80%, 90% 100%, 0 100%, 0 20%);
        }
        .btn-3d-cyan:active { top: 4px; box-shadow: 0px 0px 0px 0px #155e75; }
        
        .glass-panel {
            background: rgba(10, 10, 20, 0.85); backdrop-filter: blur(12px);
            border: 1px solid rgba(6, 182, 212, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            border-bottom: 3px solid #06b6d4;
            transition: transform 0.2s; transform-style: preserve-3d;
        }
        
        .tilt-card { transition: transform 0.1s ease-out; }
        .neon-text { text-shadow: 0 0 10px #06b6d4, 0 0 20px #fbbf24; }
        
        .input-tech {
            background: rgba(0,0,0,0.6); border: 1px solid #06b6d4;
            color: #06b6d4; padding: 12px; font-family: 'Orbitron';
            width: 100%; outline: none; clip-path: polygon(0 0, 100% 0, 100% 85%, 97% 100%, 0 100%);
        }
        .input-tech:focus { border-color: #fbbf24; box-shadow: 0 0 10px rgba(251, 191, 36, 0.3); color: white; }
        
        select.input-tech { color: white; }
        select.input-tech option { background: black; color: white; }

        .nav-btn { color: #6b7280; transition: all 0.3s; }
        .nav-btn.active { color: #fbbf24; transform: scale(1.1); text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; border: 1px solid #06b6d4; box-shadow: 0 0 20px rgba(6, 182, 212, 0.2); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .chip-btn {
            background: rgba(0,0,0,0.6); border: 1px solid #333; padding: 8px 16px; border-radius: 20px; color: #aaa; font-size: 12px; font-weight: bold; transition: 0.2s;
        }
        .chip-btn.selected { background: #06b6d4; color: black; border-color: #06b6d4; box-shadow: 0 0 10px #06b6d4; }
        
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-content { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="canvas-container"></div>

    <script type="text/babel">
        // ⚠️ SABSE IMPORTAN: APNA FIREBASE CONFIG YAHAN PASTE KARO ⚠️
        const firebaseConfig = {
  apiKey: "AIzaSyBJWklGdsRM_XNo2_4AUceUZsiIyIjbUBA",
  authDomain: "mk-esports-60429.firebaseapp.com",
  projectId: "mk-esports-60429",
  storageBucket: "mk-esports-60429.firebasestorage.app",
  messagingSenderId: "663019221754",
  appId: "1:663019221754:web:d75e59277feb0ac12a8f43",
  measurementId: "G-QJHXYR70RG"
};

        // --- ASSETS (Change Links Here) ---
        const ASSETS = {
            logo: "https://cdn-icons-png.flaticon.com/512/1604/1604335.png", // Logo Link
            defaultQr: "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=mksport@upi&pn=MKSport" // QR Link
        };

        // Whatsapp Number
        const WHATSAPP_NUMBER = "919876543210"; 

        const { useState, useEffect, useRef } = React;

        let app, auth, db;
        try {
            if (!firebase.apps.length) app = firebase.initializeApp(firebaseConfig);
            else app = firebase.app();
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (e) { console.error(e); }

        // --- 3D BACKGROUND ---
        const Background3D = () => {
            useEffect(() => {
                const container = document.getElementById('canvas-container');
                if (!container || container.children.length > 0) return;
                const scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x000000, 0.002);
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
                camera.position.z = 100; camera.position.y = 50; camera.rotation.x = -0.2;
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);
                
                const plane = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000, 40, 40), new THREE.MeshBasicMaterial({ color: 0x06b6d4, wireframe: true, transparent: true, opacity: 0.15 }));
                plane.rotation.x = -Math.PI / 2; plane.position.y = -50; scene.add(plane);

                const cubes = [];
                const boxGeometry = new THREE.BoxGeometry(4, 4, 4);
                const boxMaterial = new THREE.MeshBasicMaterial({ color: 0xfbbf24, wireframe: true });
                for (let i = 0; i < 30; i++) {
                    const mesh = new THREE.Mesh(boxGeometry, boxMaterial);
                    mesh.position.x = (Math.random() - 0.5) * 400; mesh.position.y = Math.random() * 200 - 50; mesh.position.z = (Math.random() - 0.5) * 600 - 100;
                    mesh.userData = { speedY: Math.random() * 0.2 + 0.1, rotSpeed: Math.random() * 0.05 };
                    scene.add(mesh); cubes.push(mesh);
                }
                const animate = () => {
                    requestAnimationFrame(animate);
                    cubes.forEach(cube => {
                        cube.position.y -= cube.userData.speedY;
                        cube.rotation.x += cube.userData.rotSpeed;
                        if (cube.position.y < -60) { cube.position.y = 100; }
                    });
                    renderer.render(scene, camera);
                };
                animate();
            }, []);
            return null;
        };

        const MenuBtn = ({ icon, label, onClick }) => (
            <button onClick={onClick} className="w-full glass-panel p-4 flex items-center justify-between group hover:border-yellow-500 transition-all rounded mb-3">
                <div className="flex items-center gap-4">
                    <div className="w-8 h-8 rounded-full bg-cyan-900/30 flex items-center justify-center text-cyan-400 group-hover:text-yellow-400">
                        <i className={`fa-solid fa-${icon}`}></i>
                    </div>
                    <span className="font-orbitron font-bold text-sm text-gray-300 group-hover:text-white">{label}</span>
                </div>
                <i className="fa-solid fa-chevron-right text-gray-600 group-hover:text-yellow-500"></i>
            </button>
        );

        const App = () => {
            const [view, setView] = useState('splash');
            const [userData, setUserData] = useState(null);
            const [matches, setMatches] = useState([]);
            const [paymentConfig, setPaymentConfig] = useState({ upi: "mksport@upi", qr: ASSETS.defaultQr });
            
            // Auth State
            const [isRegister, setIsRegister] = useState(false);
            const [authForm, setAuthForm] = useState({ mobile: '', email: '', password: '', confirm: '', refer: '' }); // Added Refer
            const [loading, setLoading] = useState(false);

            // App State
            const [joiningMatch, setJoiningMatch] = useState(null);
            const [joinFormData, setJoinFormData] = useState({});
            const [depositStep, setDepositStep] = useState(1);
            const [depositAmount, setDepositAmount] = useState('');
            const [showTerms, setShowTerms] = useState(false);
            const [chatMessages, setChatMessages] = useState([]);
            const [tapCount, setTapCount] = useState(0); // Secret Tap

            // Tilt Effect
            useEffect(() => {
                const handleMouseMove = (e) => {
                    document.querySelectorAll('.tilt-card').forEach(card => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left - rect.width / 2;
                        const y = e.clientY - rect.top - rect.height / 2;
                        card.style.transform = `perspective(1000px) rotateX(${-y / 15}deg) rotateY(${x / 15}deg)`;
                    });
                };
                const handleMouseLeave = () => { document.querySelectorAll('.tilt-card').forEach(c => c.style.transform = 'none'); };
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseLeave);
                return () => { document.removeEventListener('mousemove', handleMouseMove); document.removeEventListener('mouseup', handleMouseLeave); };
            }, [matches, view]);

            // Data Loading
            useEffect(() => {
                if(db) {
                    try {
                        db.collection('artifacts').doc('mksport').collection('matches').orderBy('createdAt', 'desc')
                            .onSnapshot(s => setMatches(s.docs.map(d => ({id: d.id, ...d.data()}))));
                        
                        db.collection('artifacts').doc('mksport').collection('chat').orderBy('time', 'desc').limit(50)
                            .onSnapshot(s => setChatMessages(s.docs.map(d => ({id: d.id, ...d.data()})).reverse()));
                        
                        db.collection('artifacts').doc('mksport').collection('config').doc('payment')
                            .onSnapshot(s => { if(s.exists) setPaymentConfig(s.data()); });
                    } catch(e) {}
                }
            }, []);

            // --- AUTH with REFERRAL ---
            useEffect(() => {
                if(!auth) return;
                auth.onAuthStateChanged(async (u) => {
                    if(u) {
                        const doc = await db.collection('artifacts').doc('mksport').collection('users').doc(u.uid).get();
                        if(doc.exists) setUserData(doc.data());
                        else {
                            // If new user, create profile with referral Code
                            const newReferCode = "MK" + Math.floor(1000 + Math.random() * 9000);
                            const newU = { 
                                uid: u.uid, role: 'user', balance: 0, 
                                phone: authForm.mobile || 'User', 
                                referralCode: newReferCode,
                                referredBy: authForm.refer || null 
                            };
                            await db.collection('artifacts').doc('mksport').collection('users').doc(u.uid).set(newU);
                            setUserData(newU);
                        }
                        setView('home');
                    } else { setView('auth'); }
                });
            }, []);

            const handleAuth = async () => {
                if(authForm.mobile.length !== 10) return alert("Enter 10 Digit Mobile");
                if(authForm.password.length < 6) return alert("Password min 6 chars");
                
                setLoading(true);
                const email = `${authForm.mobile}@mkesport.com`; // Proxy email
                try {
                    if(isRegister) {
                        if(authForm.password !== authForm.confirm) throw new Error("Passwords mismatch");
                        await auth.createUserWithEmailAndPassword(email, authForm.password);
                    } else {
                        await auth.signInWithEmailAndPassword(email, authForm.password);
                    }
                } catch(e) { 
                    alert(e.message); 
                    setLoading(false); 
                }
            };

            // --- FUNCTIONS ---
            const joinMatch = async (m) => {
                if((userData?.balance || 0) < m.entry) {
                    if(confirm("Low Balance! Add Cash?")) setView('wallet');
                    return;
                }
                setJoiningMatch(m); setJoinFormData({});
            };

            const submitJoin = async () => {
                if(!joiningMatch) return;
                const m = joiningMatch;
                
                if(db) {
                    try {
                        const userRef = db.collection('artifacts').doc('mksport').collection('users').doc(userData.uid);
                        const matchRef = db.collection('artifacts').doc('mksport').collection('matches').doc(m.id);
                        
                        await db.runTransaction(async (t) => {
                            const uDoc = await t.get(userRef);
                            const mDoc = await t.get(matchRef);
                            
                            if (uDoc.data().balance < m.entry) throw "Low Balance";
                            
                            // Auto-Room Allocation
                            let rooms = mDoc.data().rooms || Array.from({length:10}, (_,i)=>({id:i+1, players:[], roomId:'', roomPass:''}));
                            let joined = false;
                            rooms.forEach(r => { if(r.players.some(p => p.uid === userData.uid)) joined = true; });
                            if(joined) throw "Already Joined";

                            const roomIdx = rooms.findIndex(r => r.players.length < 48);
                            if(roomIdx === -1) throw "All Rooms Full";

                            rooms[roomIdx].players.push({
                                uid: userData.uid,
                                ign: joinFormData.ign || joinFormData.teamName,
                                details: joinFormData
                            });

                            t.update(userRef, {balance: uDoc.data().balance - m.entry});
                            t.update(matchRef, {rooms: rooms, totalJoined: (mDoc.data().totalJoined || 0) + 1});
                        });
                        alert("Joined Successfully!"); setJoiningMatch(null);
                    } catch(e) { alert("Error: " + e); }
                } else { alert("Joined (Demo)"); setJoiningMatch(null); }
            };

            const sendChat = async () => {
                const input = document.getElementById('chatInput');
                const txt = input.value; if(!txt) return;
                if(db) await db.collection('artifacts').doc('mksport').collection('chat').add({ text: txt, name: userData.phone, uid: userData.uid, time: new Date().toISOString() });
                input.value = '';
            };

            // SECRET TAP LOGIC FOR ADMIN/STAFF
            const handleSecretTap = () => {
                setTapCount(tapCount + 1);
                if(tapCount === 4) {
                    const code = prompt("ENTER SECRET CODE:");
                    if(code === "admin123") {
                        db.collection('artifacts').doc('mksport').collection('users').doc(userData.uid).update({role: 'admin'});
                        alert("Admin Panel Unlocked!"); window.location.reload();
                    } else if(code === "staff123") {
                        db.collection('artifacts').doc('mksport').collection('users').doc(userData.uid).update({role: 'staff'});
                        alert("Staff Panel Unlocked!"); window.location.reload();
                    } else {
                        alert("Wrong Code!");
                    }
                    setTapCount(0);
                }
            };

            // --- VIEWS ---
            if(view === 'splash') return <div className="h-screen bg-black flex items-center justify-center font-orbitron text-cyan-400 animate-pulse">MK ESPORT...</div>;

            if(view === 'auth') return (
                <div className="h-screen flex items-center justify-center p-6 bg-black relative z-10">
                    <Background3D />
                    <div className="glass-panel p-8 w-full max-w-sm text-center rounded-2xl">
                        <img src={ASSETS.logo} className="w-20 h-20 mx-auto rounded-full border-2 border-cyan-400 p-1 mb-4 shadow-[0_0_15px_#06b6d4]"/>
                        <h1 className="text-3xl font-orbitron font-black text-white mb-6">MK <span className="text-yellow-400">ESPORT</span></h1>
                        
                        <div className="flex bg-gray-900 p-1 rounded mb-6">
                            <button onClick={()=>setIsRegister(false)} className={`flex-1 py-2 text-xs font-bold rounded ${!isRegister ? 'bg-cyan-600 text-white' : 'text-gray-500'}`}>LOGIN</button>
                            <button onClick={()=>setIsRegister(true)} className={`flex-1 py-2 text-xs font-bold rounded ${isRegister ? 'bg-cyan-600 text-white' : 'text-gray-500'}`}>REGISTER</button>
                        </div>

                        <div className="space-y-3">
                            <input placeholder="Mobile Number" type="number" className="input-tech" onChange={e=>setAuthForm({...authForm, mobile: e.target.value})}/>
                            <input placeholder="Password" type="password" className="input-tech" onChange={e=>setAuthForm({...authForm, password: e.target.value})}/>
                            
                            {isRegister && (
                                <>
                                    <input placeholder="Confirm Password" type="password" className="input-tech" onChange={e=>setAuthForm({...authForm, confirm: e.target.value})}/>
                                    <input placeholder="Referral Code (Optional)" className="input-tech text-yellow-400 font-bold" onChange={e=>setAuthForm({...authForm, refer: e.target.value})}/>
                                </>
                            )}
                            
                            <button onClick={handleAuth} className="w-full btn-3d-cyan mt-4 py-3 font-bold">
                                {loading ? 'PLEASE WAIT...' : (isRegister ? 'CREATE ACCOUNT' : 'LOGIN')}
                            </button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-24 relative z-10">
                    <Background3D />
                    
                    <nav className="fixed w-full z-50 bg-black/90 border-b border-cyan-500/30 px-4 py-3 flex justify-between items-center backdrop-blur-md">
                        <div className="flex items-center gap-3">
                            <img src={ASSETS.logo} className="w-10 h-10 rounded-full border-2 border-cyan-400"/>
                            <span className="text-xl font-bold font-orbitron text-white">MK <span className="text-yellow-400">ESPORT</span></span>
                        </div>
                        <div onClick={()=>setView('wallet')} className="flex items-center gap-2 bg-gray-900 px-3 py-1 rounded border border-cyan-500/50">
                            <i className="fa-solid fa-wallet text-yellow-400"></i>
                            <span className="font-orbitron font-bold">₹{userData?.balance || 0}</span>
                        </div>
                    </nav>

                    <div className="pt-24 px-4 max-w-md mx-auto space-y-8">
                        {/* --- HOME --- */}
                        {view === 'home' && (
                            <>
                                <div className="video-wrapper">
                                    <iframe src="https://www.youtube.com/embed/9iW-sL7Upt0?autoplay=1&mute=1&loop=1&playlist=9iW-sL7Upt0&controls=0&modestbranding=1" title="Background Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
                                    <div className="absolute bottom-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-lg animate-pulse">LIVE NOW</div>
                                </div>

                                <div className="space-y-6">
                                    {matches.map(m => (
                                        <div key={m.id} className="tilt-card glass-panel rounded-xl overflow-hidden group border-2 border-yellow-500 shadow-[0_0_20px_rgba(234,179,8,0.2)]">
                                            <div className="h-32 bg-gray-900/40 relative">
                                                <div className="absolute inset-0 bg-cover bg-center opacity-60" style={{backgroundImage: `url(https://wallpaperaccess.com/full/2223879.jpg)`}}></div>
                                                <div className="absolute top-2 right-2 bg-yellow-500 text-black px-2 py-1 text-[10px] font-bold rounded font-orbitron">OPEN</div>
                                                <div className="absolute bottom-2 left-2 bg-black/80 border border-yellow-500 px-2 py-1 rounded text-yellow-400 text-xs font-bold font-orbitron flex items-center gap-1">{m.mode}</div>
                                            </div>
                                            <div className="p-4">
                                                <div className="flex justify-between items-start mb-2">
                                                    <h3 className="text-lg font-bold text-white font-orbitron">{m.title}</h3>
                                                    <span className="text-[10px] text-cyan-400 border border-cyan-500 px-1 rounded">{m.map}</span>
                                                </div>
                                                <div className="bg-black/40 p-2 rounded mb-3 border border-white/10 grid grid-cols-3 gap-2 text-center">
                                                    <div className="border-r border-gray-700"><p className="text-[9px] text-yellow-500">1ST</p><p className="font-bold text-white">₹{m.p1}</p></div>
                                                    <div className="border-r border-gray-700"><p className="text-[9px] text-gray-400">2ND</p><p className="font-bold text-white">₹{m.p2}</p></div>
                                                    <div><p className="text-[9px] text-gray-400">3RD</p><p className="font-bold text-white">₹{m.p3}</p></div>
                                                </div>
                                                <button onClick={()=>joinMatch(m)} className="btn-3d-cyan w-full py-2 font-black uppercase text-sm">JOIN NOW</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {/* --- CHAT --- */}
                        {view === 'chat' && (
                            <div className="h-[75vh] flex flex-col glass-panel rounded-xl overflow-hidden">
                                <div className="bg-cyan-900/30 p-3 text-center border-b border-cyan-500/20"><h3 className="font-orbitron font-bold text-cyan-400">GLOBAL CHAT</h3></div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-3">
                                    {chatMessages.length === 0 ? <p className="text-center text-gray-500 text-xs mt-10">Start chatting...</p> : chatMessages.map(msg => (
                                        <div key={msg.id} className={`flex flex-col ${msg.uid === userData.uid ? 'items-end' : 'items-start'}`}>
                                            <div className={`max-w-[80%] p-2 rounded-lg text-xs ${msg.uid === userData.uid ? 'bg-cyan-600 text-white rounded-tr-none' : 'bg-gray-800 text-gray-300 rounded-tl-none'}`}>
                                                <span className="block text-[9px] font-bold opacity-70 mb-1">{msg.name}</span>{msg.text}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="p-3 bg-black/60 flex gap-2"><input id="chatInput" className="input-tech flex-1" placeholder="Type message..." /><button onClick={sendChat} className="bg-cyan-600 w-12 h-12 flex items-center justify-center rounded text-white shadow-lg"><i className="fa-solid fa-paper-plane"></i></button></div>
                            </div>
                        )}

                        {/* --- JOIN MODAL --- */}
                        {joiningMatch && (
                            <div className="fixed inset-0 z-[100] bg-black/95 backdrop-blur-sm flex items-center justify-center p-4">
                                <div className="modal-content glass-panel w-full max-w-md p-6 rounded-2xl border-2 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.3)]">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-orbitron font-bold text-xl text-white">JOIN <span className="text-yellow-400">{joiningMatch.mode}</span></h3><button onClick={()=>setJoiningMatch(null)}><i className="fa-solid fa-xmark text-xl text-gray-400"></i></button></div>
                                    <div className="space-y-4">
                                        {joiningMatch.mode === 'SOLO' && (<><input placeholder="Free Fire Name" className="input-tech" onChange={e=>setJoinFormData({...joinFormData, ign: e.target.value})}/><input placeholder="Free Fire UID" type="number" className="input-tech" onChange={e=>setJoinFormData({...joinFormData, uid: e.target.value})}/></>)}
                                        {joiningMatch.mode !== 'SOLO' && (<><input placeholder="Team Name" className="input-tech" onChange={e=>setJoinFormData({...joinFormData, teamName: e.target.value})}/><input placeholder="Leader IGN" className="input-tech" onChange={e=>setJoinFormData({...joinFormData, p1_ign: e.target.value})}/></>)}
                                        <div className="pt-4 border-t border-gray-700 flex justify-between items-center"><div className="text-xs text-gray-400">Entry: <span className="text-white font-bold text-lg">₹{joiningMatch.entry}</span></div><button onClick={submitJoin} className="btn-3d-cyan px-6 py-2 font-bold text-sm">PAY & JOIN</button></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- PROFILE & SECRET TAP --- */}
                        {view === 'profile' && (
                            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4">
                                <div onClick={handleSecretTap} className="glass-panel p-6 flex items-center gap-5 rounded-xl border border-cyan-500/30 cursor-pointer">
                                    <img src={ASSETS.logo} className="w-16 h-16 rounded-full border-2 border-cyan-400 shadow-[0_0_15px_cyan]"/>
                                    <div><h2 className="text-xl font-orbitron font-bold text-white">{userData?.phone}</h2><p className="text-xs text-cyan-400 bg-cyan-900/30 px-2 py-0.5 rounded inline-block mt-1">Role: {userData.role}</p></div>
                                </div>
                                <div className="glass-panel p-5 rounded-xl border border-green-500/40 relative overflow-hidden">
                                    <h3 className="font-orbitron text-green-400 font-bold text-lg flex items-center gap-2"><i className="fa-solid fa-gift"></i> REFER & EARN ₹75</h3>
                                    <p className="text-xs text-gray-300 mt-1 mb-3">Share your code. Friend plays 15 Matches -> You get ₹75.</p>
                                    <div className="bg-black/50 p-2 rounded border border-dashed border-gray-600 flex justify-between items-center"><span className="font-mono text-white tracking-widest text-lg pl-2 font-bold">{userData.referralCode}</span><button onClick={()=>{navigator.clipboard.writeText(userData.referralCode); alert("Copied!");}} className="bg-green-600 text-black text-xs font-bold px-3 py-1 rounded">COPY</button></div>
                                </div>
                                <MenuBtn icon="headset" label="WHATSAPP SUPPORT" onClick={()=>window.open(`https://wa.me/${WHATSAPP_NUMBER}`, '_blank')}/>
                                <button onClick={()=>auth.signOut()} className="w-full bg-red-900/20 text-red-500 py-3 rounded border border-red-500/20 font-bold">LOGOUT</button>
                            </div>
                        )}

                        {/* --- WALLET & ADMIN VIEWS (Same as before) --- */}
                        {view === 'wallet' && (
                             <div className="glass-panel p-6 text-center space-y-4">
                                 <div><h1 className="text-5xl font-orbitron font-bold text-yellow-400 neon-text">₹{userData?.balance}</h1><p className="text-cyan-400 text-xs tracking-widest mt-2">AVAILABLE BALANCE</p></div>
                                 {depositStep === 1 && (<div className="space-y-4"><div className="grid grid-cols-2 gap-3">{[50, 100, 300, 500].map(amt => ( <button key={amt} onClick={()=>setDepositAmount(amt)} className="chip-btn text-lg">₹{amt}</button> ))}</div><input type="number" placeholder="Custom" value={depositAmount} onChange={(e)=>setDepositAmount(Number(e.target.value))} className="input-tech text-center"/><button onClick={()=>{ if(!depositAmount) return alert("Min ₹10"); setDepositStep(2); }} className="w-full btn-3d-cyan py-3 font-bold text-lg mt-4">PAY NOW</button></div>)}
                                 {depositStep === 2 && (<div className="space-y-4"><div className="bg-white p-2 w-48 h-48 mx-auto border-4 border-cyan-500 rounded-lg"><img src={paymentConfig.qr} className="w-full h-full object-contain"/></div><p className="text-white font-mono bg-black/50 p-2 rounded text-xs select-all">{paymentConfig.upi}</p><input id="utr" placeholder="Enter UTR" className="input-tech"/><div className="flex gap-2"><button onClick={()=>setDepositStep(1)} className="flex-1 bg-gray-800 text-gray-400 py-3 rounded font-bold">BACK</button><button onClick={async ()=>{ const utr = document.getElementById('utr').value; await db.collection('artifacts').doc('mksport').collection('transactions').add({ uid: userData.uid, phone: userData.phone, amount: Number(depositAmount), utr, status: 'pending', timestamp: new Date().toISOString() }); alert("Sent!"); setView('home'); setDepositStep(1); }} className="flex-[2] btn-3d-cyan py-3 font-bold">SUBMIT</button></div></div>)}
                             </div>
                        )}

                        {view === 'admin' && (
                            <div className="glass-panel p-6 border-red-500/30">
                                <h2 className="font-orbitron text-xl text-red-500 font-bold mb-4">CREATE MATCH</h2>
                                <input id="m_title" placeholder="MATCH TITLE" className="input-tech mb-3"/>
                                <select id="m_mode" className="input-tech mb-3 bg-black"><option value="SOLO">SOLO</option><option value="DUO">DUO</option><option value="SQUAD">SQUAD</option></select>
                                <div className="grid grid-cols-2 gap-3 mb-3"><input id="m_entry" type="number" placeholder="ENTRY" className="input-tech"/><input id="m_kill" type="number" placeholder="PER KILL" className="input-tech"/></div>
                                <div className="grid grid-cols-3 gap-2 mb-3"><input id="m_p1" type="number" placeholder="1ST" className="input-tech"/><input id="m_p2" type="number" placeholder="2ND" className="input-tech"/><input id="m_p3" type="number" placeholder="3RD" className="input-tech"/></div>
                                <div className="grid grid-cols-2 gap-3 mb-3"><input id="m_time" type="datetime-local" className="input-tech"/><input id="m_max" type="number" placeholder="48" className="input-tech"/></div>
                                <button onClick={async ()=>{ const t = document.getElementById('m_title').value; const mode = document.getElementById('m_mode').value; const e = document.getElementById('m_entry').value; const k = document.getElementById('m_kill').value; const p1 = document.getElementById('m_p1').value; const p2 = document.getElementById('m_p2').value; const p3 = document.getElementById('m_p3').value; const tm = document.getElementById('m_time').value; await db.collection('artifacts').doc('mksport').collection('matches').add({ title: t, mode: mode, entry: Number(e), kill: Number(k), p1: Number(p1), p2: Number(p2), p3: Number(p3), pool: Number(p1)+Number(p2)+Number(p3), time: tm, maxPlayers: 48, current: 0, createdAt: new Date().toISOString() }); alert("Published!"); }} className="w-full btn-3d-cyan bg-red-600 py-3 font-bold">PUBLISH</button>
                                {/* Payment Update */}
                                <h2 className="font-orbitron text-xl text-yellow-500 font-bold mt-6 mb-4">PAYMENT SETTINGS</h2>
                                <input id="adm_upi" placeholder="New UPI ID" className="input-tech mb-3"/><input id="adm_qr" placeholder="New QR URL" className="input-tech mb-3"/>
                                <button onClick={async ()=>{ const u = document.getElementById('adm_upi').value; const q = document.getElementById('adm_qr').value; if(db) await db.collection('artifacts').doc('mksport').collection('config').doc('payment').set({ upi: u, qr: q }); alert("Updated!"); }} className="w-full btn-3d-cyan bg-yellow-600 py-3 font-bold text-black">UPDATE</button>
                            </div>
                        )}
                        
                        {view === 'staff' && (
                            <div className="glass-panel p-6 border-blue-500/30">
                                <h2 className="font-orbitron text-xl text-blue-500 font-bold mb-4">STAFF AREA</h2>
                                {matches.map(m => (
                                    <div key={m.id} className="bg-black/60 p-4 rounded mb-4 border border-gray-700">
                                        <h3 className="font-bold text-white mb-2">{m.title}</h3>
                                        {(m.rooms || [{id:1, players:[], roomId:'', roomPass:''}]).map((room, idx) => (
                                            <div key={idx} className="bg-gray-900 p-2 rounded mb-2">
                                                <div className="flex justify-between items-center mb-2"><span className="text-yellow-400 font-bold text-xs">ROOM {idx+1}</span><span className="text-xs text-gray-400">{room.players.length}/48</span></div>
                                                <div className="flex gap-2"><input id={`rid_${m.id}_${idx}`} placeholder="ID" defaultValue={room.roomId} className="input-tech p-1 text-xs"/><input id={`pass_${m.id}_${idx}`} placeholder="Pass" defaultValue={room.roomPass} className="input-tech p-1 text-xs"/><button onClick={async ()=>{ const rid = document.getElementById(`rid_${m.id}_${idx}`).value; const pass = document.getElementById(`pass_${m.id}_${idx}`).value; const updatedRooms = [...(m.rooms || [])]; if(!updatedRooms[idx]) updatedRooms[idx] = {id: idx+1, players: [], roomId: rid, roomPass: pass}; else { updatedRooms[idx].roomId = rid; updatedRooms[idx].roomPass = pass; } await db.collection('artifacts').doc('mksport').collection('matches').doc(m.id).update({rooms: updatedRooms}); alert("Saved!"); }} className="bg-green-600 text-xs px-2 rounded">SAVE</button></div>
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <div className="fixed bottom-0 w-full bg-black/90 border-t border-cyan-500/20 p-2 flex justify-around backdrop-blur-lg z-50">
                        <button onClick={()=>setView('home')} className={`nav-btn flex flex-col items-center ${view==='home'?'active':''}`}><i className="fa-solid fa-gamepad text-xl"></i><span className="text-[10px] font-bold mt-1">PLAY</span></button>
                        <button onClick={()=>setView('wallet')} className={`nav-btn flex flex-col items-center ${view==='wallet'?'active':''}`}><i className="fa-solid fa-wallet text-xl"></i><span className="text-[10px] font-bold mt-1">CASH</span></button>
                        {userData?.role === 'admin' ? ( <button onClick={()=>setView('admin')} className="relative -top-6 bg-red-600 p-3 rounded text-white shadow-[0_0_15px_red] clip-path-polygon"><i className="fa-solid fa-shield-halved text-2xl"></i></button> ) : userData?.role === 'staff' ? ( <button onClick={()=>setView('staff')} className="relative -top-6 bg-blue-600 p-3 rounded text-white shadow-[0_0_15px_blue] clip-path-polygon"><i className="fa-solid fa-users-gear text-2xl"></i></button> ) : ( <button className="relative -top-6 bg-cyan-600 p-3 rounded text-white shadow-[0_0_15px_cyan]"><i className="fa-solid fa-trophy text-2xl"></i></button> )}
                        <button onClick={()=>setView('chat')} className={`nav-btn flex flex-col items-center ${view==='chat'?'active':''}`}><i className="fa-solid fa-comments text-xl"></i><span className="text-[10px] font-bold mt-1">CHAT</span></button>
                        <button onClick={()=>setView('profile')} className={`nav-btn flex flex-col items-center ${view==='profile'?'active':''}`}><i className="fa-solid fa-user text-xl"></i><span className="text-[10px] font-bold mt-1">ME</span></button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


